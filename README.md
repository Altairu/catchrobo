# キャチロボ用ROS2パッケージ

## 概要
このパッケージは、キャチロボの制御を行うためのROS2ノード群を提供します。各ノードは特定の機能を担当し、ロボットの動作を効率的に管理します。

## ノード一覧

### 1. can_node
- **説明**: マイコンやロボマスモーターとCAN通信を行います。
- **主な機能**:
  - データの送受信
  - デバッグ情報の処理
  - リミットスイッチの状態をトピックで送信

### 2. pid_node
- **説明**: ロボマスモーターのPID制御を行います。
- **主な機能**:
  - 比例ゲインと不感帯の設定
  - トルク値の計算
  - PID現在値のトピック受信

### 3. planning_node
- **説明**: ロボットの自動制御を行います。
- **主な機能**:
  - 動作番号と特別動作番号に基づく制御
  - リミットスイッチの状態を利用した制御


### 4. web_socket_node
- **説明**: WebSocket通信を行い、特別動作番号を操作します。
- **主な機能**:
  - スマートフォンとPC間の通信


### 5. dualshock3_node
- **説明**: DualShock3コントローラを使用して動作番号を操作します。
- **主な機能**:
  - ボタン

## アクチュエータ・センサー一覧
- **ロボマスモーター**: 1～5
- **モーター**: 1～3
- **サーボモーター**: 1～12
- **リミットスイッチ**: 1～4

## インストール方法
1. 必要な依存関係をインストールします。
2. このパッケージをROS2ワークスペースにクローンします。
3. `colcon build`を実行してビルドします。

## 使用方法
各ノードを起動するには、以下のコマンドを使用します。
```bash
ros2 run catchrobo_pkg <ノード名>
```

すべてのノードを一括で起動するには、以下のコマンドを使用します。
```bash
ros2 launch catchrobo_pkg catchrobo_launch.xml
```

## 一括セットアップスクリプト

ビルドと環境設定をまとめて行うスクリプトを用意しています。  
必ず `source` で実行してください。  
```bash
source src/mio_setup.sh
```

### 一括ビルドと起動
以下のスクリプトを使用して、アンダーレイ設定、オーバーレイ設定、ビルド、そしてすべてのノードの起動を一括で行うことができます。

1. スクリプトに実行権限を付与します。
```bash
chmod +x src/catchrobo_pkg/setup_and_launch.sh
```

2. スクリプトを実行します。
```bash
./src/catchrobo_pkg/setup_and_launch.sh
```

## CAN通信メッセージ一覧

| CAN ID | 内容                   | データ構成                                       |
| ------ | ---------------------- | ------------------------------------------------ |
| 0x200  | ロボマス1–4 目標値送信 | [M1_H, M1_L, M2_H, M2_L, M3_H, M3_L, M4_H, M4_L] |
| 0x1FF  | ロボマス5 目標値送信   | [M5_H, M5_L, 0, 0, 0, 0, 0, 0]                   |
| 0x300  | 一般モーター1–3 目標値 | [G1_H, G1_L, G2_H, G2_L, G3_H, G3_L, 0, 0]       |
| 0x400  | サーボ1–6 角度制御     | [S1, S2, S3, S4, S5, S6, 0, 0]                   |
| 0x401  | サーボ7–12 角度制御    | [S7, S8, S9, S10, S11, S12, 0, 0]                |

## CANデバイス設定

1. USB–CAN アダプタ（例: `/dev/ttyACM0`）を slcan ドライバでバインド  
   ```bash
   sudo slcand -o -c -s8 /dev/ttyACM0 can0
   ```
2. インターフェースを有効化  
   ```bash
   sudo ip link set up can0
   ```
3. 動作確認  
   ```bash
   ifconfig can0
   cansend can0 123#1122334455667788
   candump can0
   ```

## ライセンス
このパッケージは、適切なライセンスの下で提供されます。詳細は`LICENSE`ファイルを参照してください。